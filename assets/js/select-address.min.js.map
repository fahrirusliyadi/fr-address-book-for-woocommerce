{"version":3,"sources":["select-address.js"],"names":["$","SelectAddress","this","$window","window","$document","document","prototype","init","_initFieldValues","on","proxy","onChangeBillingSelect","onChangeShippingSelect","onClickEditAddress","event","$selectedField","target","_toggleFields","_updateFieldValues","type","closest","length","preventDefault","_showFields","$selectedBillingField","$selectedShippingField","addressId","val","$newButton","find","toggleClass","$fieldsWrapper","removeClass","first","focus","$form","address","fabfw_select_address","addresses","each","key","value","$field","is","append","trigger","jQuery"],"mappings":"CAQA,SAAUA,GACN,aAQA,SAASC,IACLC,KAAKC,QAAaH,EAAEI,QACpBF,KAAKG,UAAaL,EAAEM,UASxBL,EAAcM,UAAUC,KAAO,WAC3BN,KAAKO,mBAELP,KAAKG,UAAUK,GAAG,eAAgB,oEAAqEV,EAAEW,MAAMT,KAAKU,sBAAuBV,OAC3IA,KAAKG,UAAUK,GAAG,eAAgB,qEAAsEV,EAAEW,MAAMT,KAAKW,uBAAwBX,OAC7IA,KAAKG,UAAUK,GAAG,cAAe,8CAA+CV,EAAEW,MAAMT,KAAKY,mBAAoBZ,QAUrHD,EAAcM,UAAUK,sBAAwB,SAASG,GACrD,IAAIC,EAAiBhB,EAAEe,EAAME,QAE7Bf,KAAKgB,cAAc,UAAWF,GAC9Bd,KAAKiB,mBAAmB,UAAWH,IAUvCf,EAAcM,UAAUM,uBAAyB,SAASE,GACtD,IAAIC,EAAiBhB,EAAEe,EAAME,QAE7Bf,KAAKgB,cAAc,WAAYF,GAC/Bd,KAAKiB,mBAAmB,WAAYH,IAUxCf,EAAcM,UAAUO,mBAAqB,SAASC,GAClD,IAAIK,EAAOpB,EAAEe,EAAME,QAAQI,QAAQ,mCAAmCC,OAAS,UAAY,WAE3FP,EAAMQ,iBACNrB,KAAKsB,YAAYJ,IASrBnB,EAAcM,UAAUE,iBAAmB,WACvC,IAAIgB,EAA0BzB,EAAE,6CAC5B0B,EAA0B1B,EAAE,8CAEhCE,KAAKgB,cAAc,UAAWO,GAC9BvB,KAAKgB,cAAc,WAAYQ,GAC/BxB,KAAKiB,mBAAmB,UAAWM,GACnCvB,KAAKiB,mBAAmB,WAAYO,IAYxCzB,EAAcM,UAAUW,cAAgB,SAASE,EAAMJ,GAGnD,GAAKA,EAAeM,OAApB,CAIA,IAAIK,EAAcX,EAAeY,MAC7BC,EAAcb,EAAeK,QAAQ,mCAAmCS,KAAK,uBAAyBV,EAAO,qBAEjHpB,EAAE,gBAAkBoB,EAAO,0BAA0BW,YAAY,SAAwB,QAAdJ,GAC3EE,EAAWE,YAAY,WAA0B,QAAdJ,KAUvC1B,EAAcM,UAAUiB,YAAc,SAASJ,GAC3C,IAAIY,EAAkBhC,EAAE,gBAAkBoB,EAAO,0BAEjDY,EAAeC,YAAY,UAC3BD,EAAeF,KAAK,kBAAkBI,QAAQC,SAWlDlC,EAAcM,UAAUY,mBAAqB,SAASC,EAAMJ,GACxD,IAAIoB,EAAkBpB,EAAeK,QAAQ,QACzCgB,EAAkBC,qBAAqBC,UAAUvB,EAAeY,OAE/DS,GAILrC,EAAEwC,KAAKH,EAAS,SAASI,EAAKC,GAC1B,IAAIC,EAASP,EAAMN,KAAK,IAAMV,EAAO,IAAMqB,GAEtCE,EAAOrB,QAAUqB,EAAOf,QAAUc,IAKnCC,EAAOC,GAAG,YAAcD,EAAOb,KAAK,iBAAmBY,EAAQ,MAAMpB,QACrEqB,EAAOE,OAAO,kBAAoBH,EAAQ,KAAOA,EAAQ,aAG7DC,EAAOf,IAAIc,GAGXC,EAAOG,QAAQ,eAIvB,IAAI7C,GAAgBO,OA9JxB,CAgKGuC","file":"select-address.min.js","sourcesContent":["/* global fabfw_select_address */\n/**\n * Select address script on checkout page.\n * \n * @since 1.0.0\n * @param {jQuery} $\n * @returns {undefined}\n */\n(function($) {\n    \"use strict\";\n    \n    /**\n     * Select address class.\n     * \n     * @since 1.0.0\n     * @returns {SelectAddress}\n     */\n    function SelectAddress() {\n        this.$window    = $(window);\n        this.$document  = $(document);\n    }\n    \n    /**\n     * Initialize.\n     * \n     * @since 1.0.0\n     * @returns {undefined}\n     */\n    SelectAddress.prototype.init = function() {\n        this._initFieldValues();\n        \n        this.$document.on('change.fabfw', '.fabfw-select-address-container [name=\"fabfw_address_billing_id\"]', $.proxy(this.onChangeBillingSelect, this));\n        this.$document.on('change.fabfw', '.fabfw-select-address-container [name=\"fabfw_address_shipping_id\"]', $.proxy(this.onChangeShippingSelect, this));\n        this.$document.on('click.fabfw', '.fabfw-select-address-container .fabfw-edit', $.proxy(this.onClickEditAddress, this));\n    };\n    \n    /**\n     * Change event handler for select billing address field.\n     * \n     * @since 1.0.0\n     * @param {Event} event\n     * @returns {undefined}\n     */\n    SelectAddress.prototype.onChangeBillingSelect = function(event) {\n        var $selectedField = $(event.target);\n        \n        this._toggleFields('billing', $selectedField);\n        this._updateFieldValues('billing', $selectedField);\n    };\n    \n    /**\n     * Change event handler for select shipping address field.\n     * \n     * @since 1.0.0\n     * @param {Event} event\n     * @returns {undefined}\n     */\n    SelectAddress.prototype.onChangeShippingSelect = function(event) {\n        var $selectedField = $(event.target);\n        \n        this._toggleFields('shipping', $selectedField);\n        this._updateFieldValues('shipping', $selectedField);\n    };\n    \n    /**\n     * Click event handler for edit address link.\n     * \n     * @since 1.0.0\n     * @param {Event} event\n     * @returns {undefined}\n     */\n    SelectAddress.prototype.onClickEditAddress = function(event) {\n        var type = $(event.target).closest('#fabfw_address_billing_id_field').length ? 'billing' : 'shipping';\n        \n        event.preventDefault();        \n        this._showFields(type);\n    };\n    \n    /**\n     * Initialize address field values on load.\n     * \n     * @since 1.0.0\n     * @returns {undefined}\n     */\n    SelectAddress.prototype._initFieldValues = function() {        \n        var $selectedBillingField   = $('[name=\"fabfw_address_billing_id\"]:checked');\n        var $selectedShippingField  = $('[name=\"fabfw_address_shipping_id\"]:checked');\n        \n        this._toggleFields('billing', $selectedBillingField);\n        this._toggleFields('shipping', $selectedShippingField);\n        this._updateFieldValues('billing', $selectedBillingField);\n        this._updateFieldValues('shipping', $selectedShippingField);\n    };\n    \n    /**\n     * Show the address fields if the customer wants to add a new address, otherwise\n     * hide it.\n     * \n     * @since 1.0.0\n     * @param {string} type Address type (billing|shipping).\n     * @param {jQuery} $selectedField\n     * @returns {undefined}\n     */\n    SelectAddress.prototype._toggleFields = function(type, $selectedField) {\n        // No saved address yet. The field is a input[type=hidden], so $selectedField \n        // will not contain any element.\n        if (!$selectedField.length) {\n            return;\n        }\n        \n        var addressId   = $selectedField.val();\n        var $newButton  = $selectedField.closest('.fabfw-select-address-container').find('[for=\"fabfw_address_' + type + '_id_new\"] .button');\n        \n        $('.woocommerce-' + type + '-fields__field-wrapper').toggleClass('hidden', addressId !== 'new');\n        $newButton.toggleClass('disabled', addressId === 'new');\n    };\n    \n    /**\n     * Show the address fields and focus to the first visible field.\n     * \n     * @since 1.0.0\n     * @param {string} type Address type (billing|shipping).\n     * @returns {undefined}\n     */\n    SelectAddress.prototype._showFields = function(type) {\n        var $fieldsWrapper  = $('.woocommerce-' + type + '-fields__field-wrapper');\n        \n        $fieldsWrapper.removeClass('hidden');\n        $fieldsWrapper.find(':input:visible').first().focus();\n    };\n    \n    /**\n     * Update address field values.\n     * \n     * @since 1.0.0\n     * @param {string} type Address type (billing|shipping).\n     * @param {jQuery} $selectedField\n     * @returns {undefined}\n     */\n    SelectAddress.prototype._updateFieldValues = function(type, $selectedField) {\n        var $form           = $selectedField.closest('form');\n        var address         = fabfw_select_address.addresses[$selectedField.val()];\n        \n        if (!address) {\n            return;\n        }\n        \n        $.each(address, function(key, value) {\n            var $field = $form.find('#' + type + '_' + key);\n            \n            if (!$field.length || $field.val() === value) {\n                return;\n            }\n            \n            // Create the select option if it does not exists yet.\n            if ($field.is('select') && !$field.find('option[value=\"' + value + '\"]').length) {\n                $field.append('<option value=\"' + value + '\">' + value + '</option>');\n            }\n            \n            $field.val(value);\n            // `onchange` only fires when the user types into the input and then the input loses focus.\n            // https://stackoverflow.com/a/3179392\n            $field.trigger('change');\n        });\n    };\n\n    new SelectAddress().init();\n    \n})(jQuery);"]}